0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP DATABASE IF EXISTS team14_projectdb CASCADE;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE DATABASE team14_projectdb LOCATION "project/hive/warehouse";
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> USE team14_projectdb;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Create tables
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- houses table
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE houses STORED AS AVRO LOCATION 'project/warehouse/houses' TBLPROPERTIES ('avro.schema.url'='project/warehouse/avsc/houses.avsc');
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- real estates table
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE real_estate_announcements STORED AS AVRO LOCATION 'project/warehouse/real_estate_announcements' TBLPROPERTIES ('avro.schema.url'='project/warehouse/avsc/ real_estate_announcements.avsc');
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- For checking the content of tables
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM houses LIMIT 5;
+------------------+-------------------+-------------------+---------------------+-----------------------+-----------------+-----------------+---------------------+
| houses.house_id  | houses.id_region  | houses.street_id  | houses.postal_code  | houses.building_type  | houses.geo_lon  | houses.geo_lat  | houses.object_type  |
+------------------+-------------------+-------------------+---------------------+-----------------------+-----------------+-----------------+---------------------+
| 588606           | 50                | 208270            | 141070              | 4                     | 37.8100548      | 55.915365       | 0                   |
| 588607           | 22                | 222650            | 656015              | 4                     | 83.7651033      | 53.3550108      | 0                   |
| 588615           | 22                | 561374            | 658213              | 2                     | 81.221486       | 51.5235738      | 0                   |
| 588624           | 26                | 309018            | 355031              | 0                     | 42.0114702      | 45.0240687      | 0                   |
| 588628           | 77                | 282486            | 125195              | 3                     | 37.472459       | 55.857392       | 0                   |
+------------------+-------------------+-------------------+---------------------+-----------------------+-----------------+-----------------+---------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM real_estate_announcements LIMIT 5;
+--------------------------------------------+---------------------------------------------+----------------------------------+----------------------------------+-----------------------------------+----------------------------------+---------------------------------+-----------------------------------------+-------------------------------------+
| real_estate_announcements.announcement_id  | real_estate_announcements.publication_date  | real_estate_announcements.price  | real_estate_announcements.level  | real_estate_announcements.levels  | real_estate_announcements.rooms  | real_estate_announcements.area  | real_estate_announcements.kitchen_area  | real_estate_announcements.house_id  |
+--------------------------------------------+---------------------------------------------+----------------------------------+----------------------------------+-----------------------------------+----------------------------------+---------------------------------+-----------------------------------------+-------------------------------------+
| 1                                          | 1609448400000                               | 2451300                          | 15                               | 31                                | 1                                | 30.300                          | 0.000                                   | 1632918                             |
| 2                                          | 1609448400000                               | 1450000                          | 5                                | 5                                 | 1                                | 33.000                          | 6.000                                   | 2839392                             |
| 3                                          | 1609448400000                               | 10700000                         | 4                                | 13                                | 3                                | 85.000                          | 12.000                                  | 681306                              |
| 4                                          | 1609448400000                               | 3100000                          | 3                                | 5                                 | 3                                | 82.000                          | 9.000                                   | 2839392                             |
| 5                                          | 1609448400000                               | 2500000                          | 2                                | 3                                 | 1                                | 30.000                          | 9.000                                   | 1730985                             |
+--------------------------------------------+---------------------------------------------+----------------------------------+----------------------------------+-----------------------------------+----------------------------------+---------------------------------+-----------------------------------------+-------------------------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Partitioning
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- settings
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SET hive.exec.dynamic.partition=true;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SET hive.exec.dynamic.partition.mode=nonstrict;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Create houses table with partitioning by object_type
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE houses_part (
. . . . . . . . . . . . . . . . . . . . . . .>     house_id INTEGER, id_region SMALLINT, street_id INTEGER, postal_code INTEGER, building_type SMALLINT, geo_lon FLOAT, geo_lat FLOAT
. . . . . . . . . . . . . . . . . . . . . . .> )
. . . . . . . . . . . . . . . . . . . . . . .> PARTITIONED BY (object_type SMALLINT) STORED AS AVRO LOCATION 'project/hive/warehouse/houses_part' TBLPROPERTIES ('AVRO.COMPRESS'='SNAPPY');
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Insert data into houses table while specifying partition values
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> INSERT OVERWRITE TABLE houses_part PARTITION (object_type)
. . . . . . . . . . . . . . . . . . . . . . .> SELECT house_id, id_region, street_id, postal_code, building_type, geo_lon, geo_lat, object_type
. . . . . . . . . . . . . . . . . . . . . . .> FROM houses;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Bucketing
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE real_estate_announcements_buck (
. . . . . . . . . . . . . . . . . . . . . . .>     announcement_id INTEGER, publication_date BIGINT, price BIGINT, level SMALLINT, levels SMALLINT, rooms SMALLINT, area DECIMAL(6, 3), kitchen_area DECIMAL(6, 3), house_id I NTEGER
. . . . . . . . . . . . . . . . . . . . . . .> )
. . . . . . . . . . . . . . . . . . . . . . .> CLUSTERED BY (announcement_id) into 7 buckets 
. . . . . . . . . . . . . . . . . . . . . . .> STORED AS AVRO LOCATION 'project/hive/warehouse/real_estate_announcements_buck' TBLPROPERTIES ('AVRO.COMPRESS'='SNAPPY');
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> INSERT OVERWRITE TABLE real_estate_announcements_buck
. . . . . . . . . . . . . . . . . . . . . . .> SELECT announcement_id, publication_date as publication_date, price, level, levels, rooms, area, kitchen_area, house_id
. . . . . . . . . . . . . . . . . . . . . . .> FROM real_estate_announcements;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Checking
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Select data from the houses_part partitioned by object_type
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM houses_part LIMIT 5;
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
| houses_part.house_id  | houses_part.id_region  | houses_part.street_id  | houses_part.postal_code  | houses_part.building_type  | houses_part.geo_lon  | houses_part.geo_lat  | houses_part.object_type  |
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
| 588606                | 50                     | 208270                 | 141070                   | 4                          | 37.810055            | 55.915363            | 0                        |
| 588607                | 22                     | 222650                 | 656015                   | 4                          | 83.76511             | 53.35501             | 0                        |
| 588615                | 22                     | 561374                 | 658213                   | 2                          | 81.22149             | 51.523575            | 0                        |
| 588624                | 26                     | 309018                 | 355031                   | 0                          | 42.01147             | 45.024067            | 0                        |
| 588628                | 77                     | 282486                 | 125195                   | 3                          | 37.472458            | 55.85739             | 0                        |
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM houses_part WHERE object_type = 2 LIMIT 5;
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
| houses_part.house_id  | houses_part.id_region  | houses_part.street_id  | houses_part.postal_code  | houses_part.building_type  | houses_part.geo_lon  | houses_part.geo_lat  | houses_part.object_type  |
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
| 588765                | 64                     | 116334                 | 410000                   | 3                          | 46.02886             | 51.604755            | 2                        |
| 588868                | 23                     | 287609                 | 350901                   | 0                          | 39.031925            | 45.068512            | 2                        |
| 588936                | 64                     | 399257                 | 410037                   | 4                          | 46.073353            | 51.58373             | 2                        |
| 588972                | 64                     | 208593                 | 413116                   | 0                          | 46.139965            | 51.465786            | 2                        |
| 589048                | 61                     | NULL                   | 347250                   | 4                          | 41.096745            | 47.577374            | 2                        |
+-----------------------+------------------------+------------------------+--------------------------+----------------------------+----------------------+----------------------+--------------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Select data from the real_estate_announcements_buck clustered by announcement_id
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM real_estate_announcements_buck LIMIT 5;
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
| real_estate_announcements_buck.announcement_id  | real_estate_announcements_buck.publication_date  | real_estate_announcements_buck.price  | real_estate_announcements_buck.level  | real_estate_announcements_buck.levels  | real_estate_announcements_buck.rooms  | real_estate_announcements_buck.area  | real_estate_announcements_buck.kitchen_area  | real_estate_announcements_buck.house_id  |
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
| 2345786                                         | 1616706000000                                    | 3900000                               | 1                                     | 10                                     | 2                                     | 53.300                               | 0.000                                        | 1043315                                  |
| 2345777                                         | 1616706000000                                    | 3700000                               | 9                                     | 10                                     | 3                                     | 89.000                               | 14.000                                       | 1691356                                  |
| 2345773                                         | 1616706000000                                    | 4750000                               | 4                                     | 12                                     | 1                                     | 52.900                               | 0.000                                        | 1040080                                  |
| 2345769                                         | 1616706000000                                    | 21490000                              | 10                                    | 11                                     | 2                                     | 69.000                               | 15.000                                       | 1805197                                  |
| 2345768                                         | 1616706000000                                    | 3800000                               | 1                                     | 5                                      | 2                                     | 53.000                               | 9.000                                        | 2460297                                  |
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM real_estate_announcements_buck WHERE announcement_id = 2 LIMIT 5;
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
| real_estate_announcements_buck.announcement_id  | real_estate_announcements_buck.publication_date  | real_estate_announcements_buck.price  | real_estate_announcements_buck.level  | real_estate_announcements_buck.levels  | real_estate_announcements_buck.rooms  | real_estate_announcements_buck.area  | real_estate_announcements_buck.kitchen_area  | real_estate_announcements_buck.house_id  |
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
| 2                                               | 1609448400000                                    | 1450000                               | 5                                     | 5                                      | 1                                     | 33.000                               | 6.000                                        | 2839392                                  |
+-------------------------------------------------+--------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+---------------------------------------+--------------------------------------+----------------------------------------------+------------------------------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP TABLE houses;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP TABLE real_estate_announcements;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 